## 뮤텍스, 세마포어

### 출처

>https://ournotes.tistory.com/58
>
>https://yoocoderslife.wordpress.com/2019/09/08/%EC%A0%95%EB%B3%B4%EC%B2%98%EB%A6%AC%EA%B8%B0%EC%82%AC-%EC%9E%90%EB%A3%8C%EC%A1%B0%EC%82%AC-%EC%BB%B4%ED%93%A8%ED%84%B0-%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9Cos-part-3/
>
>https://patrickryoo.tistory.com/52
>
>https://jwprogramming.tistory.com/13
>
>https://worthpreading.tistory.com/90



### 한줄 요약

#### 뮤텍스

> 교착상태 발생 조건 중 하나인 상호배제(**Mut**ual **Ex**clusion, **MutEx**)를 말하며, 한 번에 한 개의 프로세스만이 공유 자원을 사용 가능한 것을 말합니다.
>
> 공유자원을 사용하는 스레드(또는 프로세스)는 lock을 획득하여 실행하게 되고
>
> lock을 가지지 못한 스레드(프로세스)는 해당 자원을 사용할 수 없으며,  해당 자원의 lock을 갖고 있는 스레드(프로세스)만이 자원 사용을 종료하고 lock을 해제시킬 수 있습니다.

#### 세마포어

> 스레드(프로세스)의 순차 처리를 위해 만들어진 기법으로
>
> 공유 자원에 접근할 수 있는 스레드(프로세스)의 허용치를 정하여 그 이상의 스레드(프로세스)는 해당 자원을 사용할 수 없습니다.

#### 뮤텍스, 세마포어 차이점

> 가장 큰 차이점은 동기화 대상의 개수 입니다. 뮤텍스는 동기화 대상이 하나 뿐이며, 세마포어는 동기화 대상이 하나 이상일 때 사용됩니다.
>
> 뮤텍스는 상태가 0, 1 뿐인 binary 세마포어라고 생각하면 됩니다. 세마포어는 뮤텍스가 될 수 있으나 뮤텍스는 세마포어가 될 수 없습니다.
>
> lock을 갖고 있는 뮤텍스만 해당 자원의 lock을 해제할 수 있는 반면, 세마포어의 경우 각 스레드(프로세스)는 자원의 세마포어의 값을 변경할 수 있습니다. (다른 스레드(프로세스)의 사용중인 자원을 해제할 수 있음)

#### 교착상태

> 둘 이상의 프로세스가 서로 자원을 점유한 상태로 무한정 대기하는 현상을 말합니다.



### 멀티 프로세스, 멀티 스레드

#### 멀티 프로세스

- 여러 개의 CPU를 사용하여 다수의 프로세스들을 동시에 병렬로 처리하는 방법

- 프로세스 각각 독립된 메모리 영역을 갖고 있어 작업량이 많은 경우 오버헤드가 발생

- Context Switching으로 인한 성능 저하 발생

- Context Switching

  다른 프로세스를 수행하기 위해 실행중인 프로세스의 상태(문맥)을 보관하고 다음에 수행할 프로세스의 상태를 복구하는 과정을 말함

#### 멀티 스레드

- 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것
- 스레드 간 공유하는 메모리 영역이 있어 안전성 문제가 발생할 수 있음



### 교착상태

- 둘 이상의 프로세스가 서로 자원을 점유한 상태로 무한정 대기하는 현상을 말한다

- 교착상태 발생 조건

  - 상호배제 (**Mut**ual **Ex**clusion, **Mutex**) : 한번에 한 개의 프로세스만이 공유자원 사용가능
  - 점유 및 대기 (Hold and Wait) : 최소 하나의 자원을 점유하면서 다른 프로세스에 할당되어 있는 자원을 추가 점유하기 위해 대기하는 프로세스 존재
  - 비선점 (Non Preemption) : 다른 프로세스에 할당된 자원은 사용이 끝날 때 까지 강제로 빼앗을 수 없음
  - 환형 대기 (Circular Wait) : 공유자원과 이를 사용하기 위해 대기하는 프로세스들이 원형으로 구성되어 있어 자신에게 할당된 자원을 점유하면서 뒤에 있는 프로세스의 자원까지 요구

- 교착상태 제거 기법

  - 예방(Prevention) 기법

    - 교착상태가 발생하지 않도록 사전에 시스템을 제어하는 방법으로 교착상태 발생 4가지 조건 중 하나를 제거함으로써 수행됨

      자원 낭비가 심한 기법이다

    - 상호배제 부정 : 한 번에 여러개의 프로세스가 공유자원 사용 가능하게 함

    - 점유 및 대기 부정 : 프로세스 실행 전 필요한 모든 자원을 할당하여 프로세스 대기를 없애거나 자원이 점유되지않은 상태에서만 자원을 요구하도록 함

    - 비선점 부정 : 자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유하고 있는 자원을 반납하고 요구한 자원을 사용하기 위해 대기하게 함

    - 환형대기 부정 : 자원을 선형 순서로 분류하여 고유번호를 할당하고 각 프로세스는 현재 점유한 자원의 고유번호보다 앞이나 뒤, 한쪽 방향으로만 자원을 요구하도록 함

  - 회피(Avoidance) 기법
    - 교착상태가 발생할 가능성을 배제하지 않고 교착상태가 발생하면 적절히 피해나가는 방법
    - 주로 은행원 알고리즘 (Banker's Algorithm) 이 사용됨
  - 발견, 탐지(Detection) 기법
    - 교착상태에 빠진 프로세스가 있는지 점검하여 교착상태에 있는 프로세스와 자원을 발견하는 기법
    - 자원 할당 그래프를 이용하여 교착상태 탐지
  - 회복(Recovery) 기법
    - 교착상태를 일으킨 프로세스를 종료하거나 교착상태의 프로세스에 할당된 자원을 선점하여 프로세스나 자원을 회복하는 기법
    - 교착상태에 있는 모든 프로세스를 종료
    - 교착상태에 있는 프로세스들을 하나씩 종료



### 뮤텍스, 세마포어

#### 뮤텍스

- 상호배제라는 뜻으로 Critical Section을 가진 Thread들의 running time이 서로 겹치지 않게 단독으로 실행되도록 하는 기술

  특정 Thread가 Critical Section에 접근하여 작업 중에 있으면 다른 Thread들은 작업이 끝날 때 까지 Critical Section에 접근할 수 없다

  공유 자원의 데이터를 여러 스레드가 접근하는 것을 막음

- 다중 프로세스들의 공유 리소스에 대한 접근을 조율하기 위해 Synchronized 또는 lock을 사용한다

- 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다

#### 세마포어

- 프로세스의 순차 처리를 위해 만든 기법으로 프로세스끼리의 경쟁을 막아 원활한 자원 공유를 가능하게 함
- 공유 자원에 접근할 수 있는 프로세스의 허용치를 정하여 그 이상의 프로세스는 공유 자원을 사용할 수 없다
- 각 프로세스는 세마포어 값을 확인하고 변경할 수 있음
- 사용중이지 않는 자원은 프로세스가 즉시 사용 가능하며 사용중인 자원에 접근 하였다면 일정 시간 후에 다시 접근할 수 있다



#### 차이점

- 가장 큰 차이점은 동기화 대상의 개수

  뮤텍스의 경우 동기화 대상이 하나 뿐이며, 세마포어는 동기화 대상이 하나 이상일 때 사용

- 세마포어는 뮤텍스가 될 수 있지만, 뮤텍스는 세마포어가 될 수 없다

  뮤텍스는 상태가 0, 1 뿐인 binary 세마포어라고 생각하면 쉽다

- 세마포어는 소유할 수 없는 반면, 뮤텍스는 소유가 가능하며 소유주(스레드, 프로세스)가 이에 대한 책임을 진다

- 뮤텍스의 경우 소유하고 있는 스레드, 프로세스가 뮤택스를 해제하여야 다른 스레드, 프로세스가 뮤텍스를 가질 수 있으며

  세마포어의 경우 세마포어를 소유하지 않는 스레드, 프로세스가 세마포어를 해제할 수 있다

- 세마포어는 시스템 범위에 걸쳐 있고 파일시스템상의 파일 형태로 존재하는 반면,

  뮤텍스는 프로세스 범위를 가지며 프로세스가 종료될 때 자동으로 Clean up 된다



